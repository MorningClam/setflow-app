<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setflow - Musician Dashboard</title>
  
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="toast.css">
</head>
<body>

<div class="page-container">
  <div id="offline-banner">You are currently offline.</div>
  
  <div class="fixed top-0 left-0 w-full h-2/3 bg-gradient-to-b from-emerald-900/20 to-transparent pointer-events-none z-0"></div>

  <header class="app-header">
    <div class="flex items-center space-x-2 text-white">
      <img src="logo.png" alt="Setflow" class="h-8 w-8">
      <span class="text-lg font-bold tracking-tight">Setflow</span>
    </div>
    
    <div class="flex items-center space-x-1">
      <a href="setflow-notifications.html" class="btn-icon relative" aria-label="Notifications">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
        <span id="notification-badge" class="hidden absolute top-2 right-2 h-2 w-2 rounded-full bg-red-500 border border-[#171717]"></span>
      </a>
      <a href="setflow-musician-settings.html" class="btn-icon" aria-label="Settings">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
      </a>
    </div>
  </header>

  <main class="content-scroll space-y-6 relative z-10">
    
    <section class="glass-card p-5 animate-enter relative overflow-hidden">
      <div class="absolute top-0 right-0 -mt-4 -mr-4 h-24 w-24 rounded-full bg-emerald-500/20 blur-2xl"></div>
      
      <div class="flex justify-between items-start mb-6 relative z-10">
         <div>
            <h1 class="text-xl font-bold text-white" id="welcome-header">Hello, Musician</h1>
            <p class="text-[10px] text-neutral-400 font-bold uppercase tracking-wider mt-1">Career Snapshot</p>
         </div>
         <a href="setflow-earnings-report.html" class="text-right group cursor-pointer">
             <p class="text-3xl font-black text-emerald-400 flex items-center justify-end gap-1">
                <span id="hud-earnings">$0</span>
             </p>
             <p class="text-[10px] text-neutral-500 font-bold uppercase group-hover:text-white transition">YTD Earnings</p>
         </a>
      </div>
      
      <div id="stats-container" class="grid grid-cols-3 gap-4 border-t border-white/10 pt-4 relative z-10">
          <div class="text-center">
              <span class="block text-lg font-bold text-white" id="hud-gigs-count">0</span>
              <span class="text-[10px] text-neutral-500 uppercase font-bold">Gigs</span>
          </div>
          <div class="text-center border-l border-white/10">
               <span class="block text-lg font-bold text-white" id="hud-views-count">--</span>
               <span class="text-[10px] text-neutral-500 uppercase font-bold">Views</span>
          </div>
          <div class="text-center border-l border-white/10">
               <span class="block text-lg font-bold text-white truncate px-1" id="hud-next-show">TBD</span>
               <span class="text-[10px] text-neutral-500 uppercase font-bold">Next</span>
          </div>
      </div>

      <div id="onboarding-container" class="hidden mt-4 pt-4 border-t border-white/10 relative z-10">
          <div class="flex justify-between text-xs mb-2">
              <span class="text-neutral-300 font-medium">Profile Strength</span>
              <span class="text-emerald-400 font-bold">60%</span>
          </div>
          <div class="w-full bg-neutral-800 rounded-full h-1.5 mb-4 overflow-hidden">
              <div class="bg-emerald-500 h-1.5 rounded-full" style="width: 60%"></div>
          </div>
          <a href="setflow-edit-profile.html" class="block w-full text-center text-xs font-bold bg-white/10 hover:bg-white/20 border border-white/5 py-2.5 rounded-lg transition text-white">Complete Setup</a>
      </div>
    </section>

    <section class="animate-enter" style="animation-delay: 0.05s;">
        <a href="setflow-browse-gigs.html" class="glass-card flex items-center justify-between p-4 transition active:scale-95 group border border-emerald-500/30 bg-gradient-to-r from-emerald-900/20 to-transparent">
            <div class="flex items-center">
                <div class="h-10 w-10 rounded-full bg-emerald-500 flex items-center justify-center shadow-lg shadow-emerald-500/20 mr-4">
                    <svg class="h-5 w-5 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                </div>
                <div>
                    <h2 class="text-base font-bold text-white group-hover:text-emerald-300 transition">Find A Gig</h2>
                    <p class="text-[10px] text-emerald-400 font-bold uppercase tracking-wider">Browse Open Listings</p>
                </div>
            </div>
            <svg class="h-5 w-5 text-emerald-500 opacity-50 group-hover:opacity-100 transition transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
        </a>
    </section>

    <section class="animate-enter" style="animation-delay: 0.1s;">
        <h2 class="section-title">Command Center</h2>
        <div class="grid grid-cols-4 gap-3">
            <a href="setflow-calendar.html" class="glass-card flex flex-col items-center justify-center p-3 aspect-square hover:bg-white/5 border-0 bg-white/5">
                <svg class="h-6 w-6 text-white mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                <span class="text-[9px] font-bold text-neutral-400">Calendar</span>
            </a>
            <a href="setflow-promo-kit.html" class="glass-card flex flex-col items-center justify-center p-3 aspect-square hover:bg-white/5 border-0 bg-white/5">
                <svg class="h-6 w-6 text-indigo-400 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                <span class="text-[9px] font-bold text-neutral-400">Promo</span>
            </a>
            <a href="setflow-network.html" class="glass-card flex flex-col items-center justify-center p-3 aspect-square hover:bg-white/5 border-0 bg-white/5">
                <svg class="h-6 w-6 text-purple-400 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.653-.184-1.268-.5-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.653.184-1.268.5-1.857m0 0a5.002 5.002 0 019 0m-4.5-5a5 5 0 100-10 5 5 0 000 10z"></path></svg>
                <span class="text-[9px] font-bold text-neutral-400">Network</span>
            </a>
            <a href="setflow-find-a-player.html" class="glass-card flex flex-col items-center justify-center p-3 aspect-square hover:bg-white/5 border-0 bg-white/5">
                <svg class="h-6 w-6 text-sky-400 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <span class="text-[9px] font-bold text-neutral-400">Scout</span>
            </a>
        </div>
    </section>

    <section class="animate-enter" style="animation-delay: 0.2s;">
      <div class="flex items-center justify-between mb-3">
        <h2 class="section-title mb-0">Shows in the Area üìç</h2>
        <a href="setflow-local-shows.html" class="text-xs font-bold text-emerald-400 hover:text-white transition">View All</a>
      </div>
      
      <div id="local-shows-list" class="space-y-3">
          <div class="flex justify-center py-4"><div class="loading-spinner"></div></div>
      </div>
    </section>

  </main>

  <nav class="bottom-nav">
    <div id="bottom-nav-container" class="flex w-full h-full justify-around"></div>
  </nav>
</div>

<div id="toast-notification"></div>

<script src="toast.js"></script>
<script src="nav.js"></script>
<script type="module" src="api.js"></script>
<script type="module">
  // Dashboard Logic
  import { onAuthState, gracefulGet, getUserData, fetchCompletedGigsForUser, fetchLocalShows, escapeHTML, isOnline } from './api.js';
  
  if(!isOnline()) document.getElementById('offline-banner').style.display = 'block';

  onAuthState(async (user) => {
      if(user) {
          // Initialize Nav
          const userData = await gracefulGet(getUserData(user.uid));
          if (window.renderBottomNav) window.renderBottomNav('musician', 'free', 'setflow-musician-dashboard.html');
          
          if(userData?.name) document.getElementById('welcome-header').textContent = `Hello, ${userData.name.split(' ')[0]}`;
          
          // Load Data...
          const completed = await gracefulGet(fetchCompletedGigsForUser(user.uid)) || [];
          document.getElementById('hud-gigs-count').textContent = completed.length;
          
          loadLocalFeed();
      } else {
          window.location.href = 'setflow-login-page.html';
      }
  });

  async function loadLocalFeed() {
      const list = document.getElementById('local-shows-list');
      if(!list) return;
      
      const shows = await fetchLocalShows();
      list.innerHTML = '';

      if (!shows || shows.length === 0) {
          list.innerHTML = `
            <div class="text-center py-6 bg-white/5 rounded-xl border border-dashed border-white/10">
                <p class="text-neutral-400 text-sm">No upcoming shows nearby.</p>
            </div>
          `;
          return;
      }

      shows.slice(0, 3).forEach(show => {
          const isOfficial = show.isOfficial;
          const div = document.createElement('div');
          
          const borderClass = isOfficial ? 'border-emerald-500/30 bg-emerald-900/10' : 'border-transparent bg-white/5';
          const btnClass = isOfficial 
              ? 'bg-emerald-500 text-black hover:bg-emerald-400' 
              : 'border border-white/10 bg-white/5 text-neutral-300 hover:text-white hover:bg-white/10';
          
          const [month, day] = show.formattedDate.split(' ');

          div.className = `glass-card flex rounded-xl overflow-hidden transition active:scale-[0.98] border ${borderClass} relative mb-3 items-center`;
          div.innerHTML = `
              ${isOfficial ? '<div class="absolute top-0 right-0 bg-emerald-500 text-black text-[8px] font-black px-2 py-0.5 rounded-bl-lg uppercase tracking-wider z-10">Official</div>' : ''}
              <div class="w-14 h-full min-h-[4rem] ${isOfficial ? 'bg-emerald-500/10' : 'bg-white/5'} flex flex-col items-center justify-center border-r border-white/5 shrink-0">
                  <span class="text-[9px] font-bold ${isOfficial ? 'text-emerald-400' : 'text-neutral-500'} uppercase">${month}</span>
                  <span class="text-lg font-black text-white">${day}</span>
              </div>
              <div class="p-3 flex-1 min-w-0 flex justify-between items-center">
                  <div class="min-w-0 mr-3">
                      <h3 class="font-bold text-white truncate text-sm leading-tight">${escapeHTML(show.title)}</h3>
                      <p class="text-xs ${isOfficial ? 'text-emerald-300' : 'text-neutral-400'} truncate mt-0.5">${escapeHTML(show.venue)} ‚Ä¢ ${show.time}</p>
                  </div>
                  <a href="${show.link}" class="text-[10px] font-bold rounded-lg px-3 py-1.5 transition shadow-lg whitespace-nowrap ${btnClass}">${show.action}</a>
              </div>
          `;
          list.appendChild(div);
      });
  }
</script>
</body>
</html>