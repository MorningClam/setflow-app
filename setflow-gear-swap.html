<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Setflow - Gear Swap</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>body{font-family:'Inter',sans-serif}</style>
</head>
<body class="bg-neutral-900 text-white antialiased">
<div class="max-w-md mx-auto min-h-screen flex flex-col">
  <header class="px-5 py-4 bg-neutral-800/80 backdrop-blur-sm sticky top-0 z-20 shadow-md border-b border-neutral-700/50">
    <div class="flex items-center justify-between">
      <a href="Setflow - MoreMenu.html" class="p-2 rounded-lg hover:bg-neutral-700"><svg class="w-5 h-5 text-neutral-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a>
      <h1 class="text-lg font-bold tracking-tight">Gear Swap</h1>
      <a href="Setflow - Sell Item.html" class="px-3 py-1 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-sm font-medium">Sell</a>
    </div>
    <div class="mt-3">
      <div class="flex items-center bg-neutral-800 border border-neutral-700 rounded-lg px-3">
        <svg class="w-4 h-4 text-neutral-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
        <input type="search" placeholder="Search for pedals, guitars, amps..." class="w-full py-2 bg-transparent text-sm outline-none placeholder-neutral-500">
      </div>
    </div>
  </header>
  <main id="gear-container" class="flex-1 px-5 py-4 pb-28 grid grid-cols-2 gap-4">
    <p class="col-span-2 text-neutral-500">Loading gear...</p>
  </main>
</div>

<script type="module">
  import { onAuthState, fetchGearListings } from './api.js';

  const gearContainer = document.getElementById('gear-container');

  function renderListings(listings) {
    gearContainer.innerHTML = ''; // Clear loading message

    if (!listings || listings.length === 0) {
      gearContainer.innerHTML = `<p class="col-span-2 text-center mt-8 text-neutral-500">No gear has been listed for sale yet.</p>`;
      return;
    }

    listings.forEach(item => {
      const itemCard = document.createElement('a');
      // In a real app, the link would go to a detailed view of the item
      itemCard.href = `Setflow - Gear Detail.html?id=${item.id}`; 
      itemCard.className = 'block bg-neutral-800 rounded-xl border border-neutral-700/60 overflow-hidden';
      itemCard.innerHTML = `
        <img class="h-32 w-full object-cover" src="${item.imageUrl}" alt="${item.name}">
        <div class="p-3">
            <h3 class="font-semibold text-white truncate">${item.name}</h3>
            <p class="text-sm text-neutral-400">${item.location || 'USA'}</p>
            <p class="text-lg font-bold text-emerald-400 mt-1">$${item.price}</p>
        </div>
      `;
      gearContainer.appendChild(itemCard);
    });
  }

  onAuthState(async (user) => {
    if (user) {
      try {
        const listings = await fetchGearListings();
        renderListings(listings);
      } catch (error) {
        console.error("Failed to fetch gear listings:", error);
        gearContainer.innerHTML = `<p class="col-span-2 text-red-400">Could not load gear listings.</p>`;
      }
    } else {
      window.location.href = 'Setflow - Login Page.html';
    }
  });
</script>
</body>
</html>